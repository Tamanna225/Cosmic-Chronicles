<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Moon Phase</title>
</head>
<body>
<h1>Daily Moon Phase</h1>
<div id="moon-phase"></div>

<script>
function calculateMoonPhase(date) {
    // The duration in days of a lunar cycle
    var lunarDays = 29.53058770576;
    // Date time of first new moon in year 2000
    var new2000 = new Date("2000-01-06T18:14:00Z").getTime() / 1000;

    // Convert the input date to Unix timestamp
    var unixDate = date.getTime() / 1000;

    // Calculate seconds between date and new moon 2000
    var totalSecs = unixDate - new2000;

    // The modulus to drop completed cycles
    var lunarSecs = lunarDays * (24 * 60 *60);
    var currentSecs = totalSecs % lunarSecs;

    // If negative number (date before new moon 2000) add lunarSecs
    if ( currentSecs < 0 ) {
        currentSecs += lunarSecs;
    }

    // Calculate the fraction of the moon cycle
    var currentFrac = currentSecs / lunarSecs;

    // Calculate days in current cycle (moon age)
    var currentDays = currentFrac * lunarDays;
    
    // Calculate the percentage of the moon phase
    var phasePercentage = (currentDays / lunarDays) * 100;

    // Array with start and end of each phase
    var phases = [
        ["New Moon", 0, 1],
        ["Waxing Crescent", 1, 6.38264692644],
        ["First Quarter", 6.38264692644, 8.38264692644],
        ["Waxing Gibbous", 8.38264692644, 13.76529385288],
        ["Full Moon", 13.76529385288, 15.76529385288],
        ["Waning Gibbous", 15.76529385288, 21.14794077932],
        ["Last Quarter", 21.14794077932, 23.14794077932],
        ["Waning Crescent", 23.14794077932, 28.53058770576],
        ["New Moon", 28.53058770576, 29.53058770576]
    ];

    // Find current phase in the array
    var thePhase;
    for (var i = 0; i < phases.length; i++) {
        if (currentDays >= phases[i][1] && currentDays <= phases[i][2]) {
            thePhase = phases[i][0];
            break;
        }
    }
    
    // Find the date of the next new moon
    var nextNewMoonDate = new Date(date);
    nextNewMoonDate.setDate(nextNewMoonDate.getDate() + (29.53 - currentDays));

    return {
        phase: thePhase,
        percentage: phasePercentage.toFixed(2),
        nextNewMoon: nextNewMoonDate.toDateString()
    };
}

// Update the moon phase display
function updateMoonPhaseDisplay() {
    var currentDate = new Date();
    var moonInfo = calculateMoonPhase(currentDate);

    var moonPhaseDisplay = 'Moon Phase: ' + moonInfo.phase + '<br>';
    moonPhaseDisplay += 'Percentage of Lunation: ' + moonInfo.percentage + '%<br>';
    moonPhaseDisplay += 'Next New Moon: ' + moonInfo.nextNewMoon;

    document.getElementById('moon-phase').innerHTML = moonPhaseDisplay;
    // var moonPhase = calculateMoonPhase(currentDate);

    // document.getElementById('moon-phase').innerHTML = 'Moon Phase: ' + moonPhase;
}

// Update the moon phase display initially
updateMoonPhaseDisplay();

// Update the moon phase display every day
setInterval(updateMoonPhaseDisplay, 24 * 60 * 60 * 1000); // Update every 24 hours
// setInterval(updateMoonPhaseDisplay, 1000); // Update every 24 hours
</script>
</body>
</html>
